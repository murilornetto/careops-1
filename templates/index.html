<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>{{ title }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap via CDN só pra ficar bonitinho -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    >
</head>
<body class="bg-light">
<nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4">
  <div class="container">
    <span class="navbar-brand">CareOps+ · DevSecOps Lab</span>
  </div>
</nav>

<div class="container">
  <div class="row justify-content-center">
    <div class="col-lg-6 col-md-8">

      <div class="card shadow-sm mb-4">
        <div class="card-body">
          <h5 class="card-title">Status da API</h5>
          <p class="card-text">
            Esta é a mini aplicação de exemplo da disciplina
            <strong>Segurança de Aplicações (DevSecOps)</strong>.
          </p>
          <button id="health-btn" class="btn btn-outline-primary btn-sm">
            Testar /health
          </button>
          <span id="health-status" class="ms-2 text-muted"></span>
        </div>
      </div>

      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title">Calculadora simples (/sum)</h5>
          <p class="card-text">
            Simula um cálculo qualquer em um sistema de saúde
            (por exemplo, soma de doses, valores de exames, etc.).
          </p>

          <form id="sum-form" class="row g-3">
            <div class="col-md-6">
              <label for="a" class="form-label">Valor A</label>
              <input type="number" step="any" class="form-control" id="a" required>
            </div>
            <div class="col-md-6">
              <label for="b" class="form-label">Valor B</label>
              <input type="number" step="any" class="form-control" id="b" required>
            </div>
            <div class="col-12">
              <button type="submit" class="btn btn-primary">Calcular</button>
              <span id="sum-result" class="ms-3 fw-bold"></span>
            </div>
          </form>
        </div>
      </div>

    </div>
  </div>
</div>

<script>
  // Teste do /health
  document.getElementById("health-btn").addEventListener("click", async () => {
    const statusSpan = document.getElementById("health-status");
    statusSpan.textContent = " testando...";
    try {
      const resp = await fetch("/health");
      if (!resp.ok) {
        statusSpan.textContent = " erro (" + resp.status + ")";
        statusSpan.className = "ms-2 text-danger";
        return;
      }
      const data = await resp.json();
      statusSpan.textContent = " status: " + data.status;
      statusSpan.className = "ms-2 text-success";
    } catch (e) {
      statusSpan.textContent = " erro de rede";
      statusSpan.className = "ms-2 text-danger";
    }
  });

  // Formulário da soma
  document.getElementById("sum-form").addEventListener("submit", async (e) => {
    e.preventDefault();
    const a = document.getElementById("a").value;
    const b = document.getElementById("b").value;
    const resultSpan = document.getElementById("sum-result");
    resultSpan.textContent = " calculando...";

    try {
      const resp = await fetch(`/sum?a=${encodeURIComponent(a)}&b=${encodeURIComponent(b)}`);
      const data = await resp.json();

      if (!resp.ok) {
        resultSpan.textContent = " erro: " + (data.detail || "parâmetros inválidos");
        resultSpan.className = "ms-3 text-danger fw-bold";
        return;
      }

      resultSpan.textContent = " resultado: " + data.result;
      resultSpan.className = "ms-3 text-success fw-bold";
    } catch (err) {
      resultSpan.textContent = " erro de rede";
      resultSpan.className = "ms-3 text-danger fw-bold";
    }
  });
</script>

</body>
</html>